# Deployment Guide

This guide covers deploying the CyberTabletop game to AWS for under $30/month.

## Quick Start - AWS EC2 Deployment

### Estimated Cost: $9-20/month

- **EC2 t3.micro**: ~$8-10/month (on-demand) or ~$7-8/month (1-year reserved)
- **EBS Storage (20GB)**: ~$2/month
- **Data Transfer**: First 100GB free/month
- **Total**: ~$9-12/month (well under $30 budget!)

### Step 1: Launch EC2 Instance

1. Go to [AWS EC2 Console](https://console.aws.amazon.com/ec2/)
2. Click "Launch Instance"
3. Configure:
   - **Name**: `cybertabletop-game`
   - **AMI**: Amazon Linux 2023 or Ubuntu 22.04 LTS
   - **Instance Type**: `t3.micro` (sufficient for 20+ players)
   - **Key Pair**: Create or select existing
   - **Network Settings**: 
     - Create security group with:
       - **HTTP (80)**: `0.0.0.0/0`
       - **Backend (8000)**: `0.0.0.0/0` (or restrict to your IP)
       - **SSH (22)**: Your IP only
   - **Storage**: 20GB (default)
4. Launch instance

### Step 2: Connect and Deploy

```bash
# Connect to instance
ssh -i your-key.pem ec2-user@YOUR_INSTANCE_IP
# For Ubuntu: ssh -i your-key.pem ubuntu@YOUR_INSTANCE_IP

# Clone repository
cd /opt
sudo git clone https://github.com/zerop0wn/cybertabletopgame.git
sudo chown -R $USER:$USER cybertabletopgame
cd cybertabletopgame

# Run deployment script
chmod +x aws/deploy.sh
./aws/deploy.sh
```

### Step 3: Configure

Edit `/opt/cybertabletop/.env`:

```bash
nano /opt/cybertabletop/.env
```

Update:
- `GM_ADMIN_PASSWORD`: Change from default
- `VITE_PUBLIC_BACKEND_URL`: Use your EC2 public IP or domain (e.g., `http://YOUR_EC2_IP:8000`)

### Step 4: Access Your Game

- **Frontend**: `http://YOUR_EC2_IP`
- **Backend API**: `http://YOUR_EC2_IP:8000`

## Optional: Set Up Domain with SSL

If you have a domain:

1. **Point DNS** to your EC2 IP (A record)
2. **Run SSL setup**:
   ```bash
   cd /opt/cybertabletop/aws
   chmod +x setup-ssl.sh
   ./setup-ssl.sh your-domain.com your-email@example.com
   ```
3. **Update `.env`**: Set `VITE_PUBLIC_BACKEND_URL=https://your-domain.com:8000`
4. **Restart**: `docker-compose -f docker-compose.prod.yml restart`

## Architecture Options

### Option 1: Single EC2 (Simplest) - $9-12/month
- Everything on one EC2 instance
- Frontend served via nginx in Docker
- Backend API on port 8000
- **Best for**: Quick deployment, low cost

### Option 2: EC2 + S3/CloudFront - $10-12/month
- Frontend on S3 + CloudFront (CDN)
- Backend on EC2
- **Best for**: Better performance, global distribution

### Option 3: EC2 + Domain + SSL - $10-15/month
- EC2 instance
- Custom domain with SSL/TLS
- **Best for**: Production use, professional appearance

## Performance for 20+ Players

The `t3.micro` instance can easily handle:
- 20+ concurrent WebSocket connections
- Real-time game events
- Multiple simultaneous games

For better performance with 30+ players, use `t3.small` (~$16-18/month).

## Monitoring

### View Logs
```bash
cd /opt/cybertabletop
docker-compose -f docker-compose.prod.yml logs -f
```

### Check Status
```bash
docker-compose -f docker-compose.prod.yml ps
```

### Restart Services
```bash
docker-compose -f docker-compose.prod.yml restart
```

## Updates

```bash
cd /opt/cybertabletop
git pull
docker-compose -f docker-compose.prod.yml build
docker-compose -f docker-compose.prod.yml up -d
```

## Security Checklist

- [ ] Change default admin password
- [ ] Use strong JWT_SECRET (auto-generated by deploy script)
- [ ] Restrict backend port 8000 in security group if possible
- [ ] Set up SSL/TLS for production
- [ ] Regularly update Docker images
- [ ] Monitor CloudWatch for unusual activity

## Troubleshooting

See `aws/README.md` for detailed troubleshooting guide.

## Cost Optimization

1. **Use Reserved Instances**: Save 40% with 1-year commitment
2. **Stop when not in use**: Only pay for storage when stopped
3. **Monitor data transfer**: First 100GB/month is free
4. **Use S3 for frontend**: Reduce EC2 load and costs

